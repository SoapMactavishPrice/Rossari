<template>
    <lightning-card>
        <!-- Header -->
        <!-- <div class="slds-p-around_xx-small slds-text-align_center slds-border_bottom slds-theme_shade"
            style="margin-left: -4px;background-color: #9d0b0f; color: #ffffff;">
            <h3 class="slds-text-heading_small" style="margin: 0;">Add/Edit Address Information</h3>
        </div> -->

        <!-- Body -->
        <div class="slds-p-around_medium">
            <!-- Address Type Tabs -->
            <div class="slds-tabs_default">
                <ul class="slds-tabs_default__nav" role="tablist">
                    <li class={billToTabClass} title="Bill To" role="presentation">
                        <a class="slds-tabs_default__link" href="javascript:void(0);" role="tab"
                            aria-controls="bill-to-tab" onclick={handleTabChange} data-type="Bill_To">
                            Bill To Addresses
                        </a>
                    </li>
                    <li class={shipToTabClass} title="Ship To" role="presentation">
                        <a class="slds-tabs_default__link" href="javascript:void(0);" role="tab"
                            aria-controls="ship-to-tab" onclick={handleTabChange} data-type="Ship_To">
                            Ship To Addresses
                        </a>
                    </li>
                </ul>
            </div>


            <!-- Existing Addresses Section -->
            <div class="slds-m-top_medium">
                <!-- <h3 class="slds-text-heading_small slds-m-bottom_small">Existing {currentAddressType} Addresses</h3> -->

                <template if:true={addresses.length}>
                    <div class="slds-scrollable_y" style="max-height: 300px;">
                        <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                            <thead>
                                <tr class="slds-text-title_caps">
                                    <th scope="col">Name</th>
                                    <th scope="col">Street</th>
                                    <th scope="col">Pin Code</th>
                                    <th scope="col">City</th>
                                    <th scope="col">State</th>
                                    <th scope="col">Country</th>
                                    <th scope="col" style="margin-right: 10px;text-align:center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={addresses} for:item="addr">
                                    <tr key={addr.Id} class="slds-hint-parent">
                                        <td>{addr.Name}</td>
                                        <td style="width: 200px; word-wrap: break-word; white-space: normal;">
                                            <div>{addr.Street_1__c}</div>
                                            <div>{addr.Street_2__c}</div>
                                            <div>{addr.Street_3__c}</div>
                                        </td>
                                        <td>{addr.PinCodeName}</td>
                                        <td>{addr.CityName}</td>
                                        <td>{addr.StateName}</td>
                                        <td>{addr.CountryName}</td>
                                        <td style="text-align:center">
                                            <lightning-button-icon icon-name="utility:edit" alternative-text="edit"
                                                title="edit" data-id={addr.Id} onclick={handleEditAddress}
                                                style="color: #9d0b0f;margin-right:10px">
                                            </lightning-button-icon>
                                            <lightning-button-icon icon-name="utility:delete" alternative-text="Delete"
                                                title="Delete" data-id={addr.Id} onclick={handleDeleteAddress}
                                                style="color: #9d0b0f;margin-right:10px">
                                            </lightning-button-icon>
                                            <lightning-button-icon icon-name="utility:add" alternative-text="Add"
                                                title="Add New Address" onclick={handleAddNewClick}
                                                style="color: #9d0b0f;">
                                            </lightning-button-icon>

                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    <template if:true={addresses.length}>
                        <template if:false={formVisible}>
                            <div class="slds-text-align_center slds-m-top_medium">
                                <lightning-button label="Cancel" variant="neutral" onclick={handleCancel}>
                                </lightning-button>
                            </div>
                        </template>
                    </template>
                </template>
                <template if:false={addresses.length}>
                    <div class="slds-notify slds-notify_alert slds-theme_alert-texture" role="alert">
                        <span class="slds-assistive-text">info</span>
                        <h2>No {currentAddressType} addresses found for this account</h2>
                    </div>

                    <template if:false={formVisible}>
                        <div class="slds-grid slds-grid_align-center slds-m-top_medium">
                            <div class="slds-m-right_small">
                                <lightning-button label="Add Address" variant="brand" onclick={handleAddNewClick}>
                                </lightning-button>
                            </div>
                            <div>
                                <lightning-button label="Cancel" variant="neutral" onclick={handleCancel}>
                                </lightning-button>
                            </div>
                        </div>
                    </template>
                </template>



            </div>

            <!-- Add/Edit Address Form -->
            <div class={formClass} style="margin-top: -90px;">
                <lightning-record-edit-form object-api-name="Address_Information__c" record-id={currentAddressId}
                    onsubmit={handleSubmit} onsuccess={handleSuccess} onerror={handleError} style="margin-top: -100px;">

                    <lightning-messages></lightning-messages>

                    <!-- Hidden Fields -->
                    <lightning-input-field field-name="Account__c" value={recordId} class="slds-hidden">
                    </lightning-input-field>
                    <lightning-input-field field-name="RecordTypeId" value={currentRecordTypeId} class="slds-hidden">
                    </lightning-input-field>

                    <!-- Field Layout Grid -->
                    <div class="slds-grid slds-wrap slds-gutters slds-m-bottom_medium">
                        <div class="slds-col slds-size_1-of-3">
                            <label class="slds-form-element__label">Street 1</label>
                            <lightning-input-field field-name="Street_1__c" variant="label-hidden">
                            </lightning-input-field>
                        </div>
                        <div class="slds-col slds-size_1-of-3">
                            <label class="slds-form-element__label">Street 2</label>
                            <lightning-input-field field-name="Street_2__c" variant="label-hidden">
                            </lightning-input-field>
                        </div>
                        <div class="slds-col slds-size_1-of-3">
                            <label class="slds-form-element__label">Street 3</label>
                            <lightning-input-field field-name="Street_3__c" variant="label-hidden">
                            </lightning-input-field>
                        </div>

                        <div class="slds-col slds-size_1-of-3">
                            <lightning-combobox name="region" label="Region" value={regionValue}
                                placeholder="Select Region" options={regionOptions} onchange={handleRegionChange}>
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-3">
                            <lightning-combobox name="country" label="Country" value={countryId}
                                placeholder="Select Country" options={countryOptions} onchange={handleCountryChange}>
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-3">
                            <lightning-record-picker label="Pin Code" object-api-name="Pin_Code__c" display-field="Name"
                                value-field="Id" value={currentPinCodeId} placeholder="Search Pin Code..."
                                onchange={handlePinCodeChange} disabled={isPinCodeLoading}>
                            </lightning-record-picker>
                            <template if:true={isPinCodeLoading}>
                                <div class="slds-spinner_container">
                                    <div class="slds-spinner slds-spinner_small" role="alert">
                                        <span class="slds-assistive-text">Loading</span>
                                        <div class="slds-spinner__dot-a"></div>
                                        <div class="slds-spinner__dot-b"></div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div class="slds-col slds-size_1-of-3">
                            <lightning-record-picker label="City" object-api-name="City__c" display-field="Name"
                                value-field="Id" value={cityId} placeholder="Search City..."
                                onchange={handleCityChange}>
                            </lightning-record-picker>
                        </div>

                        <div class="slds-col slds-size_1-of-3">
                            <lightning-record-picker label="State" object-api-name="State__c" display-field="Name"
                                value-field="Id" value={stateId} placeholder="Search State..."
                                onchange={handleStateChange}>
                            </lightning-record-picker>
                        </div>

                        <div class="slds-col slds-size_1-of-3">
                            <lightning-combobox name="zone" label="Zone" value={zoneValue} placeholder="Select Zone"
                                options={zoneOptions} onchange={handleZoneChange}>
                            </lightning-combobox>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="slds-border_top slds-p-top_medium slds-text-align_center">
                        <lightning-button type="submit" label={saveButtonLabel} variant="brand"
                            class="slds-m-right_small">
                            <span if:true={isSaving}
                                class="slds-spinner slds-spinner_brand slds-spinner_x-small"></span>
                        </lightning-button>
                        <lightning-button label="Cancel" variant="neutral" onclick={handleCancel1}>
                        </lightning-button>
                    </div>
                </lightning-record-edit-form>
            </div>
        </div>
    </lightning-card>
</template>