<template>
    <lightning-card>
        <template if:true={showSpinner}>
            <div class="slds-align_absolute-center slds-m-around_large">
                <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
            </div>
        </template>

        <!-- Header -->
        <div class="slds-scrollable_x custom-scroll">
            <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered">
                <thead>
                    <tr>
                        <th
                            style="text-align: center; font-size:15px; background-color:#9d0b0f; color:white; padding:12px;">
                            Add Company Users
                        </th>
                    </tr>
                </thead>
            </table>
        </div>

        <!-- Data table -->
        <div class="slds-m-top_medium">
            <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered">
                <thead>
                    <tr class="slds-text-heading_small">
                        <th style="width: 25%;">User</th>
                        <th style="width: 20%;">Division</th>
                        <th style="width: 20%;">Product Group</th>
                        <th style="width: 15%;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <template for:each={companyUsers} for:item="user" for:index="index">
                        <tr key={user.id} class="slds-hint-parent">
                            <!-- User Column -->
                            <td>
                                <c-custom-sales-area-lookup object-api-name="User" value={user.User__c}
                                    placeholder="Search User..." data-index={index} data-field="User__c"
                                    onchange={handleLookupChange}></c-custom-sales-area-lookup>
                            </td>

                            <!-- Division Column -->
                            <td>
                                <c-custom-sales-area-lookup object-api-name="Division__c" value={user.Division__c}
                                    placeholder="Search Division..." data-index={index} data-field="Division__c"
                                    filter-params={user.divisionFilter}
                                    onchange={handleLookupChange}></c-custom-sales-area-lookup>
                            </td>

                            <!-- Product Group Column -->
                            <td>
                                <c-custom-sales-area-lookup object-api-name="Product_Group__c"
                                    value={user.Product_Group__c} placeholder="Search Product Group..."
                                    data-index={index} data-field="Product_Group__c"
                                    filter-params={user.productGroupFilter}
                                    onchange={handleLookupChange}></c-custom-sales-area-lookup>
                            </td>

                            <!-- Action Column -->
                            <td>
                                <lightning-button-icon icon-name="utility:add" alternative-text="Add" title="Add Row"
                                    onclick={addNewRow} class="slds-m-right_xx-small">
                                </lightning-button-icon>
                                <lightning-button-icon icon-name="utility:delete" alternative-text="Delete"
                                    title="Remove Row" data-index={index} onclick={removeRow}>
                                </lightning-button-icon>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>

            <div class="slds-align_absolute-center slds-m-top_medium slds-m-bottom_medium" style="margin-top: 60px;">
                <lightning-button variant="brand" label="Save" onclick={handleSave} disabled={showSpinner}>
                </lightning-button>
                <lightning-button variant="neutral" label="Cancel" class="slds-m-left_small" onclick={handleCancel}
                    disabled={showSpinner}>
                </lightning-button>
            </div>
        </div>
    </lightning-card>
</template>