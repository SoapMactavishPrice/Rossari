<template>
    <lightning-card title="Business Partner Information" icon-name="standard:account">
        <div class="slds-p-around_medium">
            <lightning-accordion active-section-name={activeSection} onsectiontoggle={handleSectionToggle}>
                <!-- General Data -->
                <lightning-accordion-section name="general" label="General Data">

                        

                    <lightning-layout multiple-rows>

                        <!-- Row 1 -->
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small" >
                            <lightning-input label="Account Group" data-label="account_Group" onchange={handleCustomerChange} value ={fieldMap.account_Group} ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Name" data-label="name" onchange={handleCustomerChange} value ={fieldMap.name} ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Name 2" data-label="name_2" onchange={handleCustomerChange} value ={fieldMap.name_2}></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Title" data-label="title" onchange={handleCustomerChange} value ={fieldMap.title} ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Search Term" data-label="search_Term" onchange={handleCustomerChange} value ={fieldMap.name} ></lightning-input>
                        </lightning-layout-item>

                        <!-- Row 2 -->
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="PAN Number" data-label="pan_Number" onchange={handleCustomerChange} value ={fieldMap.pan_Number}></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Street" data-label="street" onchange={handleCustomerChange} value ={fieldMap.name} ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Postal Code" data-label="postal_Code" onchange={handleCustomerChange} value ={fieldMap.postal_Code} ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="City" data-label="city" onchange={handleCustomerChange} value ={fieldMap.city} ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Country" data-label="country" onchange={handleCustomerChange} value ={fieldMap.country}></lightning-input>
                        </lightning-layout-item>

                        <!-- Row 3 -->
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="State" data-label="state" onchange={handleCustomerChange} value ={fieldMap.state}></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Street 2" data-label="street_2" onchange={handleCustomerChange} value ={fieldMap.street_2}
                                ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Street 3" data-label="street_3" onchange={handleCustomerChange} value ={fieldMap.street_3}
                                ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Language" data-label="language" onchange={handleCustomerChange} value ={fieldMap.language} ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Telephone" data-label="telephone" onchange={handleCustomerChange} value ={fieldMap.telephone} ></lightning-input>
                        </lightning-layout-item>

                        <!-- Row 4 -->
                        <lightning-layout-item size="12" large-device-size="2" class="slds-p-around_small">
                            <lightning-input label="Email" data-label="email" onchange={handleCustomerChange} value ={fieldMap.email} ></lightning-input>
                        </lightning-layout-item>

                    </lightning-layout>

                </lightning-accordion-section>

                <!-- BP Roles -->
                <lightning-accordion-section name="bpRoles" label="BP Roles">
                    <div class="slds-m-around_medium">
                        <table class="slds-table slds-table_cell-buffer custom-bordered-table">
                            <thead>
                                <tr class="slds-text-title_caps">
                                    <template for:each={columns} for:item="col">
                                        <th key={col.fieldName}>{col.label}</th>
                                    </template>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={tableData} for:item="row">
                                    <tr key={row.bpRole}>
                                        <td>{row.customerNumber}</td>
                                        <td>{row.bpRole}</td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </lightning-accordion-section>

                <!-- Sales Data -->
                <lightning-accordion-section name="salesData" label="Sales Data">

                    <template for:each={salesData} for:item="row">
                <div key={row.uniqueId} class="slds-box slds-m-vertical_x-small">

                    <!-- Row 1 -->
                    <lightning-layout horizontal-align="spread">
                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Customer Number"
                                value={row.Customer_Number}
                                data-id={row.uniqueId}
                                data-field="Customer_Number"
                                disabled>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Sales Organization"
                                value={row.Sales_Organization}
                                data-id={row.uniqueId}
                                data-field="Sales_Organization"
                                disabled>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Distribution Channel"
                                value={row.Distribution_Channel}
                                data-id={row.uniqueId}
                                data-field="Distribution_Channel"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Division"
                                value={row.Division}
                                data-id={row.uniqueId}
                                data-field="Division"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Customer Group"
                                value={row.Customer_Group}
                                data-id={row.uniqueId}
                                data-field="Customer_Group"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Sales District"
                                value={row.Sales_District}
                                data-id={row.uniqueId}
                                data-field="Sales_District"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>
                    </lightning-layout>

                    <!-- Row 2 -->
                    <lightning-layout horizontal-align="spread">
                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Order Probability of the Item (%)"
                                value={row.Order_Probability}
                                data-id={row.uniqueId}
                                data-field="Order_Probability"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Currency"
                                value={row.Currency}
                                data-id={row.uniqueId}
                                data-field="Currency"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Exchange Rate Type"
                                value={row.Exchange_Rate_Type}
                                data-id={row.uniqueId}
                                data-field="Exchange_Rate_Type"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Price Group"
                                value={row.Price_Group}
                                data-id={row.uniqueId}
                                data-field="Price_Group"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Price Procedure Dterm"
                                value={row.Price_Procedure_Dterm}
                                data-id={row.uniqueId}
                                data-field="Price_Procedure_Dterm"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Customer Statistics Group"
                                value={row.Customer_Statistics_Group}
                                data-id={row.uniqueId}
                                data-field="Customer_Statistics_Group"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>
                    </lightning-layout>

                    <!-- Row 3 -->
                    <lightning-layout horizontal-align="spread">
                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Delivery Priority"
                                value={row.Delivery_Priority}
                                data-id={row.uniqueId}
                                data-field="Delivery_Priority"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Order Combination"
                                value={row.Order_Combination}
                                data-id={row.uniqueId}
                                data-field="Order_Combination"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Shipping Conditions"
                                value={row.Shipping_Conditions}
                                data-id={row.uniqueId}
                                data-field="Shipping_Conditions"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Delivery Plant"
                                value={row.Delivery_Plant}
                                data-id={row.uniqueId}
                                data-field="Delivery_Plant"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Incoterms"
                                value={row.Incoterms}
                                data-id={row.uniqueId}
                                data-field="Incoterms"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Inco. Location1"
                                value={row.Inco_Location1}
                                data-id={row.uniqueId}
                                data-field="Inco_Location1"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>
                    </lightning-layout>

                    <!-- Row 4 -->
                    <lightning-layout horizontal-align="spread">
                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Payment Terms"
                                value={row.Payment_Terms}
                                data-id={row.uniqueId}
                                data-field="Payment_Terms"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Account Assignment Group"
                                value={row.Account_Assignment_Group}
                                data-id={row.uniqueId}
                                data-field="Account_Assignment_Group"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <lightning-layout-item size="2" class="slds-p-around_small">
                            <lightning-input
                                label="Customer Group 1"
                                value={row.Customer_Group1}
                                data-id={row.uniqueId}
                                data-field="Customer_Group1"
                                onchange={handleSalesRowChange}>
                            </lightning-input>
                        </lightning-layout-item>

                        <!-- Remove Row Button -->
                        <lightning-layout-item size="1" class="slds-align_absolute-center">
                           <lightning-icon icon-name="action:new" size="x-small"
    onclick={addSalesRow}
    data-id={row.uniqueId}>
</lightning-icon>

   <lightning-icon icon-name="action:delete" size="x-small"
        title="Remove Row" class="slds-m-left_small"
        onclick={removeSalesRow} if:true={isMoreThanOneRow}
        data-id={row.uniqueId}>
    </lightning-icon>


                        </lightning-layout-item>
                    </lightning-layout>
                </div>
            </template>
                </lightning-accordion-section>

                <!-- Sales Partner -->
                <lightning-accordion-section name="salesPartner" label="Sales Partner">
                    <lightning-layout horizontal-align="spread">
                        <lightning-layout-item size="2" large-device-size="2">Customer Number</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Sales Organization</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Distribution
                            Channel</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Division</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Partner Function</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Employee Id</lightning-layout-item>
                    </lightning-layout>

                </lightning-accordion-section>

                <!-- Company Data -->
                <lightning-accordion-section name="companyData" label="Company Data">
                    <div class="slds-m-around_medium">
                        <table class="slds-table slds-table_cell-buffer custom-bordered-table">
                            <thead>
                                <tr class="slds-text-title_caps">
                                    <template for:each={companyHeader} for:item="col">
                                        <th key={col.fieldName}>{col.label}</th>
                                    </template>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={companyHeaderata} for:item="row" for:index="index">
                                    <tr key={row.bpRole}>
                                        <td>{row.customerNumber}</td>
                                        <td>{row.ccCode}</td>
                                        <td>{row.ptCode}</td>
                                        

                                        <td>
                                            <lightning-input data-index={index} data-feild="raRole" variant="label-hidden" onchange={onCompanyDataChange} value={row.raRole}></lightning-input>
                                         </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </lightning-accordion-section>

                <!-- Output Tax -->
                <lightning-accordion-section name="outputTax" label="Output Tax">
                    <div class="slds-m-around_medium">
                        <table class="slds-table slds-table_cell-buffer custom-bordered-table">
                            <thead>
                                <tr class="slds-text-title_caps">
                                    <template for:each={outputTaxHeader} for:item="col">
                                        <th key={col.fieldName}>{col.label}</th>
                                    </template>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={outputTaxdata} for:item="row">
                                    <tr key={row.bpRole}>
                                        <td>{row.customerNumber}</td>
                                        <td>{row.countRegion}</td>
                                        <td>{row.taxCat}</td>
                                        <td>{row.taxClass}</td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </lightning-accordion-section>

                <!-- Tax Numbers -->
                <lightning-accordion-section name="taxNumbers" label="Tax Numbers">
                    <div class="slds-m-around_medium">
                        <table class="slds-table slds-table_cell-buffer custom-bordered-table">
                            <thead>
                                <tr class="slds-text-title_caps">
                                    <template for:each={TaxHeader} for:item="col">
                                        <th key={col.fieldName}>{col.label}</th>
                                    </template>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={Taxdata} for:item="row"  for:index="index">
                                    <tr key={row.bpRole}>
                                        <td>{row.customerNumber}</td>
                                        <td>{row.taxCat}</td>
                                        <td>
                                            <lightning-input data-index={index} variant="label-hidden" onchange={onTaxDataChange} data-feild="taxNum" value={row.taxNum}></lightning-input>
                                         </td>
                                        
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </lightning-accordion-section>
            </lightning-accordion>
        </div>
        
         <footer class="slds-modal__footer slds-grid slds-grid_align-end slds-p-around_small">
            
                    <lightning-button variant="neutral" label="Cancel" onclick={closeModal}></lightning-button>
                    <lightning-button variant="neutral" label="Refresh" onclick={handleRefresh}></lightning-button>
                    <lightning-button variant="brand" label="Save" onclick={handleSave}></lightning-button>
                    <lightning-button variant="brand" label="Save & Send" onclick={sendXlsEmail}></lightning-button>
        </footer>
        
    </lightning-card>


    <template if:true={isModalOpen}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <!-- Header -->
                <header class="slds-modal__header">
                    <h2 class="slds-text-heading_medium">Send File Email</h2>
                </header>

                <!-- Body -->
                <div class="slds-modal__content slds-p-around_medium">
                    <lightning-input 
                        type="email"
                        label="To Email"
                        value={toEmail}
                        onchange={handleChange}
                        data-field="toEmail">
                    </lightning-input>

                    <lightning-input 
                        type="text"
                        label="CC Email (comma separated)"
                        value={ccEmail}
                        onchange={handleChange}
                        data-field="ccEmail"
                        placeholder="abc@test.com, xyz@test.com">
                    </lightning-input>

                    <lightning-input 
                        type="text"
                        label="Subject"
                        value={subject}
                        onchange={handleChange}
                        data-field="subject">
                    </lightning-input>

                    <lightning-textarea 
                        label="Body"
                        value={body}
                        onchange={handleChange}
                        data-field="body">
                    </lightning-textarea>
                </div>

                <footer class="slds-modal__footer slds-grid slds-grid_align-end slds-p-around_small">
                <lightning-button variant="brand" label="Send Email" onclick={handleSaveAndSend}></lightning-button>
                </footer>

            </div>
                    
        </section>


        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

</template>




                    <!-- <lightning-layout horizontal-align="spread">
                        <lightning-layout-item size="2" large-device-size="2">Customer Number
              <lightning-input label="Customer Number" data-label="Customer_Number" onchange={handleSalesChange} disabled 
              value ={fieldMap.Customer_Number} ></lightning-input>

                        </lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">
                             <lightning-input label="Sales Organization" data-label="Sales_Organization" onchange={handleSalesChange} disabled 
              value ={fieldMap.Sales_Organization} ></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Distribution
                            Channel</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Division</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Customer Group</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Sales District</lightning-layout-item>
                    </lightning-layout>

                    <lightning-layout horizontal-align="spread">
                        <lightning-layout-item size="2" large-device-size="2">Order Probability of the Item
                            (%)</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Currency</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Exchange Rate Type</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Price Group</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Price Procedure
                            Dterm</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Customer Statistics
                            Group</lightning-layout-item>
                    </lightning-layout>

                    <lightning-layout horizontal-align="spread">
                        <lightning-layout-item size="2" large-device-size="2">Delivery Priority</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Order Combination</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Shipping
                            Conditions</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Delivery Plant</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Incoterms</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Inco. Location1</lightning-layout-item>
                    </lightning-layout>

                    
                    <lightning-layout horizontal-align="spread">
                        <lightning-layout-item size="2" large-device-size="2">Payment Terms</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Account Assignment
                            Group</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2">Customer Group 1</lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2"></lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2"></lightning-layout-item>
                        <lightning-layout-item size="2" large-device-size="2"></lightning-layout-item>
                    </lightning-layout>
             -->